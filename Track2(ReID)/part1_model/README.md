This folder contains source codes of training vehicle type classification model, vehicle orientation classification model and three vehicle reid models including se_resnext101, resnet101 and se_resnet152. These codes are based on [open-reid](https://github.com/Cysu/open-reid).


**Before running these codesï¼Œthe environments shouled be prepared and related paths should be modified.**
**Specifically, all dependencies should be installed, the datasets should be put into './examples/data' and pretrained models should be put into './pretrain_models/'.**

## Code Structure 

Run ```sh train_reid_model.sh``` to train vehicle reid models. To train different models mentioned above, the network architecture name should be modified. Available network names can be found in 'reid/models/__init__.py'.  

Run ```sh train_direction.sh``` to train vehicle orientation classification model.  

Run ```sh train_multi_attribute.sh``` to train train_multi_attribute.sh.  

Run ```sh run_test_attribute.sh``` to get vehicle type prediction results. Specifically, two pickle files should be obtained containing softmax vehicle type vectors of each test image. The trained model should be put into the related path indicated by 'run_test_attribute.sh'.  

Run ```python ./reid/extract_fea_from_dir.py``` to extract reid features of each test image. In our implementation, the average feature of one image and its corresponding flip image is used. Please note again, some paths or network architecture name should be modified before running the code. Finally, pickle files containing reid features of each test image will be obtained.  

Run ``` python ./reid/extract_direction_from_dir.py``` to extract softmax vehicle orientation vectors of each test image. Similarly, model weights, paths, etc. should be set up.

## Some Important Pickle Files Related to This Part ##

Several important pickle files are available at [pickle_file](https://pan.baidu.com/s/1u6d6dX0uPvyrqgOB0O4Qyg) (extract code: p3fg). Some files related to this part are listed below. The remainings will be introduced by other parts.

```query_newbig7_cat_complete.pkl and test_newbig7_cat_complete.pkl```: The final reid feature, which is the concatenation of all 7 models' results mentioned in our paper. Most models provide the average feature of normal images and the corresponding crop image generated by our detector.  

```distmat_newbig7_no_strategy_no_multi_no_rerank.pickle```: Euclidean distance matrix between each pair of test images.  

```query_direction.pkl and gallery_direction.pkl```: The predicted vehicle orientation results of query and gallery images, respectively.  

```q_q_direct_sim.pkl, q_g_direct_sim.pkl and g_g_direct_sim.pkl```: The vehicle orientation similarity between each pair of images of query_query, query_gallery and gallery_gallery sets, respectively.  

```query_new_attribute.pkl and gallery_new_attribute.pkl```: The predicted vehicle type results of query and gallery images, respectively.  

```type_sim.pkl```: The vehicle type similarity between each pair of images.  





